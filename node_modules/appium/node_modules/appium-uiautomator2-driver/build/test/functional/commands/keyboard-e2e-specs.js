'use strict';

var _regeneratorRuntime = require('babel-runtime/regenerator')['default'];

var _getIterator = require('babel-runtime/core-js/get-iterator')['default'];

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _this = this;

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

var _sampleApps = require('sample-apps');

var _sampleApps2 = _interopRequireDefault(_sampleApps);

var _2 = require('../../..');

var _3 = _interopRequireDefault(_2);

_chai2['default'].should();
_chai2['default'].use(_chaiAsPromised2['default']);

var EDITTEXT_CLASS = 'android.widget.EditText';

var PACKAGE = 'io.appium.android.apis';
var TEXTFIELD_ACTIVITY = '.view.TextFields';

var defaultAsciiCaps = {
  app: (0, _sampleApps2['default'])('ApiDemos-debug'),
  deviceName: 'Android',
  platformName: 'Android',
  newCommandTimeout: 90,
  appPackage: PACKAGE,
  appActivity: TEXTFIELD_ACTIVITY
};

var defaultUnicodeCaps = _lodash2['default'].defaults({
  unicodeKeyboard: true,
  resetKeyboard: true
}, defaultAsciiCaps);

function deSamsungify(text) {
  // For samsung S5 text is appended with ". Editing."
  return text.replace(". Editing.", "");
}

function runTextEditTest(driver, testText) {
  var keys = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];
  var el, text;
  return _regeneratorRuntime.async(function runTextEditTest$(context$1$0) {
    while (1) switch (context$1$0.prev = context$1$0.next) {
      case 0:
        context$1$0.t0 = _lodash2['default'];
        context$1$0.next = 3;
        return _regeneratorRuntime.awrap(driver.findElOrEls('class name', EDITTEXT_CLASS, true));

      case 3:
        context$1$0.t1 = context$1$0.sent;
        el = context$1$0.t0.last.call(context$1$0.t0, context$1$0.t1);

        el = el.ELEMENT;
        context$1$0.next = 8;
        return _regeneratorRuntime.awrap(driver.clear(el));

      case 8:
        if (!keys) {
          context$1$0.next = 13;
          break;
        }

        context$1$0.next = 11;
        return _regeneratorRuntime.awrap(driver.keys([testText]));

      case 11:
        context$1$0.next = 15;
        break;

      case 13:
        context$1$0.next = 15;
        return _regeneratorRuntime.awrap(driver.setValue(testText, el));

      case 15:
        context$1$0.next = 17;
        return _regeneratorRuntime.awrap(driver.getText(el));

      case 17:
        text = context$1$0.sent;

        deSamsungify(text).should.be.equal(testText);

        return context$1$0.abrupt('return', el);

      case 20:
      case 'end':
        return context$1$0.stop();
    }
  }, null, this);
}

var tests = [{ label: 'editing a text field', text: 'Life, the Universe and Everything.' }, { label: 'sending \'&-\'', text: '&-' }, { label: 'sending \'&\' and \'-\' in other text', text: 'In the mid-1990s he ate fish & chips as mayor-elect.' }, { label: 'sending \'-\' in text', text: 'Super-test.' }, { label: 'sending numbers', text: '0123456789' }];

var unicodeTests = [{ label: 'should be able to send \'-\' in unicode text', text: 'परीक्षा-परीक्षण' }, { label: 'should be able to send \'&\' in text', text: 'Fish & chips' }, { label: 'should be able to send \'&\' in unicode text', text: 'Mīna & chips' }, { label: 'should be able to send roman characters with diacritics', text: 'Áé Œ ù ḍ' }, { label: 'should be able to send a \'u\' with an umlaut', text: 'ü' }];

var languageTests = [{ label: 'should be able to send Tamil', text: 'சோதனை' }, { label: 'should be able to send Gujarati', text: 'પરીક્ષણ' }, { label: 'should be able to send Chinese', text: '测试' }, { label: 'should be able to send Russian', text: 'тестирование' }, { label: 'should be able to send Arabic', text: 'تجريب' }, { label: 'should be able to send Hebrew', text: 'בדיקות' }];

describe('keyboard', function () {
  describe('ascii', function () {
    var driver = undefined;
    before(function callee$2$0() {
      var engines, selectedEngine, _iteratorNormalCompletion, _didIteratorError, _iteratorError, _iterator, _step, engine;

      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            driver = new _3['default']();
            context$3$0.next = 3;
            return _regeneratorRuntime.awrap(driver.createSession(defaultAsciiCaps));

          case 3:
            context$3$0.next = 5;
            return _regeneratorRuntime.awrap(driver.availableIMEEngines());

          case 5:
            engines = context$3$0.sent;
            selectedEngine = _lodash2['default'].first(engines);
            _iteratorNormalCompletion = true;
            _didIteratorError = false;
            _iteratorError = undefined;
            context$3$0.prev = 10;

            for (_iterator = _getIterator(engines); !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
              engine = _step.value;

              // it seems that the latin ime has `android.inputmethod` in its package name
              if (engine.indexOf('android.inputmethod') !== -1) {
                selectedEngine = engine;
              }
            }
            context$3$0.next = 18;
            break;

          case 14:
            context$3$0.prev = 14;
            context$3$0.t0 = context$3$0['catch'](10);
            _didIteratorError = true;
            _iteratorError = context$3$0.t0;

          case 18:
            context$3$0.prev = 18;
            context$3$0.prev = 19;

            if (!_iteratorNormalCompletion && _iterator['return']) {
              _iterator['return']();
            }

          case 21:
            context$3$0.prev = 21;

            if (!_didIteratorError) {
              context$3$0.next = 24;
              break;
            }

            throw _iteratorError;

          case 24:
            return context$3$0.finish(21);

          case 25:
            return context$3$0.finish(18);

          case 26:
            context$3$0.next = 28;
            return _regeneratorRuntime.awrap(driver.activateIMEEngine(selectedEngine));

          case 28:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this, [[10, 14, 18, 26], [19,, 21, 25]]);
    });
    after(function callee$2$0() {
      return _regeneratorRuntime.async(function callee$2$0$(context$3$0) {
        while (1) switch (context$3$0.prev = context$3$0.next) {
          case 0:
            context$3$0.next = 2;
            return _regeneratorRuntime.awrap(driver.deleteSession());

          case 2:
          case 'end':
            return context$3$0.stop();
        }
      }, null, _this);
    });

    describe('editing a text field', function () {
      before(function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.startActivity(PACKAGE, TEXTFIELD_ACTIVITY));

            case 2:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });

      var _iteratorNormalCompletion2 = true;
      var _didIteratorError2 = false;
      var _iteratorError2 = undefined;

      try {
        var _loop = function () {
          var test = _step2.value;

          describe(test.label, function () {
            it('should work with setValue', function callee$5$0() {
              return _regeneratorRuntime.async(function callee$5$0$(context$6$0) {
                while (1) switch (context$6$0.prev = context$6$0.next) {
                  case 0:
                    context$6$0.next = 2;
                    return _regeneratorRuntime.awrap(runTextEditTest(driver, test.text));

                  case 2:
                  case 'end':
                    return context$6$0.stop();
                }
              }, null, _this);
            });
            it('should work with keys', function callee$5$0() {
              return _regeneratorRuntime.async(function callee$5$0$(context$6$0) {
                while (1) switch (context$6$0.prev = context$6$0.next) {
                  case 0:
                    context$6$0.next = 2;
                    return _regeneratorRuntime.awrap(runTextEditTest(driver, test.text, true));

                  case 2:
                  case 'end':
                    return context$6$0.stop();
                }
              }, null, _this);
            });
          });
        };

        for (var _iterator2 = _getIterator(tests), _step2; !(_iteratorNormalCompletion2 = (_step2 = _iterator2.next()).done); _iteratorNormalCompletion2 = true) {
          _loop();
        }
      } catch (err) {
        _didIteratorError2 = true;
        _iteratorError2 = err;
      } finally {
        try {
          if (!_iteratorNormalCompletion2 && _iterator2['return']) {
            _iterator2['return']();
          }
        } finally {
          if (_didIteratorError2) {
            throw _iteratorError2;
          }
        }
      }

      it('should be able to clear a password field', function callee$3$0() {
        var els, el;
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.findElOrEls('class name', EDITTEXT_CLASS, true));

            case 2:
              els = context$4$0.sent;
              el = els[1].ELEMENT;
              context$4$0.next = 6;
              return _regeneratorRuntime.awrap(driver.setValue('super-duper password', el));

            case 6:
              context$4$0.next = 8;
              return _regeneratorRuntime.awrap(driver.clear(el));

            case 8:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
    });

    describe('unicode', function () {
      var driver = undefined;
      before(function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              driver = new _3['default']();
              context$4$0.next = 3;
              return _regeneratorRuntime.awrap(driver.createSession(defaultUnicodeCaps));

            case 3:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });
      after(function callee$3$0() {
        return _regeneratorRuntime.async(function callee$3$0$(context$4$0) {
          while (1) switch (context$4$0.prev = context$4$0.next) {
            case 0:
              context$4$0.next = 2;
              return _regeneratorRuntime.awrap(driver.deleteSession());

            case 2:
            case 'end':
              return context$4$0.stop();
          }
        }, null, _this);
      });

      describe('editing a text field', function () {
        before(function callee$4$0() {
          return _regeneratorRuntime.async(function callee$4$0$(context$5$0) {
            while (1) switch (context$5$0.prev = context$5$0.next) {
              case 0:
                context$5$0.next = 2;
                return _regeneratorRuntime.awrap(driver.startActivity(PACKAGE, TEXTFIELD_ACTIVITY));

              case 2:
              case 'end':
                return context$5$0.stop();
            }
          }, null, _this);
        });

        var _arr = [tests, unicodeTests, languageTests];
        for (var _i = 0; _i < _arr.length; _i++) {
          var testSet = _arr[_i];var _iteratorNormalCompletion3 = true;
          var _didIteratorError3 = false;
          var _iteratorError3 = undefined;

          try {
            var _loop2 = function () {
              var test = _step3.value;

              describe(test.label, function () {
                it('should work with setValue', function callee$6$0() {
                  return _regeneratorRuntime.async(function callee$6$0$(context$7$0) {
                    while (1) switch (context$7$0.prev = context$7$0.next) {
                      case 0:
                        context$7$0.next = 2;
                        return _regeneratorRuntime.awrap(runTextEditTest(driver, test.text));

                      case 2:
                      case 'end':
                        return context$7$0.stop();
                    }
                  }, null, _this);
                });
                it('should work with keys', function callee$6$0() {
                  return _regeneratorRuntime.async(function callee$6$0$(context$7$0) {
                    while (1) switch (context$7$0.prev = context$7$0.next) {
                      case 0:
                        context$7$0.next = 2;
                        return _regeneratorRuntime.awrap(runTextEditTest(driver, test.text, true));

                      case 2:
                      case 'end':
                        return context$7$0.stop();
                    }
                  }, null, _this);
                });
              });
            };

            for (var _iterator3 = _getIterator(testSet), _step3; !(_iteratorNormalCompletion3 = (_step3 = _iterator3.next()).done); _iteratorNormalCompletion3 = true) {
              _loop2();
            }
          } catch (err) {
            _didIteratorError3 = true;
            _iteratorError3 = err;
          } finally {
            try {
              if (!_iteratorNormalCompletion3 && _iterator3['return']) {
                _iterator3['return']();
              }
            } finally {
              if (_didIteratorError3) {
                throw _iteratorError3;
              }
            }
          }
        }
      });
    });
  });
});

// sometimes the default ime is not what we are using

// there is currently no way to assert anything about the contents
// of a password field, since there is no way to access the contents
// but this should, at the very least, not fail
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3RcXGZ1bmN0aW9uYWxcXGNvbW1hbmRzXFxrZXlib2FyZC1lMmUtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7OztvQkFBaUIsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7c0JBQy9CLFFBQVE7Ozs7MEJBQ0MsYUFBYTs7OztpQkFDRSxVQUFVOzs7O0FBRWhELGtCQUFLLE1BQU0sRUFBRSxDQUFDO0FBQ2Qsa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsSUFBTSxjQUFjLEdBQUcseUJBQXlCLENBQUM7O0FBRWpELElBQU0sT0FBTyxHQUFHLHdCQUF3QixDQUFDO0FBQ3pDLElBQU0sa0JBQWtCLEdBQUcsa0JBQWtCLENBQUM7O0FBRTlDLElBQUksZ0JBQWdCLEdBQUc7QUFDckIsS0FBRyxFQUFFLDZCQUFXLGdCQUFnQixDQUFDO0FBQ2pDLFlBQVUsRUFBRSxTQUFTO0FBQ3JCLGNBQVksRUFBRSxTQUFTO0FBQ3ZCLG1CQUFpQixFQUFFLEVBQUU7QUFDckIsWUFBVSxFQUFFLE9BQU87QUFDbkIsYUFBVyxFQUFFLGtCQUFrQjtDQUNoQyxDQUFDOztBQUVGLElBQUksa0JBQWtCLEdBQUcsb0JBQUUsUUFBUSxDQUFDO0FBQ2xDLGlCQUFlLEVBQUUsSUFBSTtBQUNyQixlQUFhLEVBQUUsSUFBSTtDQUNwQixFQUFFLGdCQUFnQixDQUFDLENBQUM7O0FBRXJCLFNBQVMsWUFBWSxDQUFFLElBQUksRUFBRTs7QUFFM0IsU0FBTyxJQUFJLENBQUMsT0FBTyxDQUFDLFlBQVksRUFBRSxFQUFFLENBQUMsQ0FBQztDQUN2Qzs7QUFFRCxTQUFlLGVBQWUsQ0FBRSxNQUFNLEVBQUUsUUFBUTtNQUFFLElBQUkseURBQUcsS0FBSztNQUN4RCxFQUFFLEVBVUYsSUFBSTs7Ozs7O3lDQVZjLE1BQU0sQ0FBQyxXQUFXLENBQUMsWUFBWSxFQUFFLGNBQWMsRUFBRSxJQUFJLENBQUM7Ozs7QUFBeEUsVUFBRSxrQkFBSyxJQUFJOztBQUNmLFVBQUUs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Q0FBQzs7OztBQUNMLG9CQUFNLEdBQUcsbUJBQStCLENBQUM7OytDQUNuQyxNQUFNLENBQUMsYUFBYSxDQUFDLGtCQUFrQixDQUFDOzs7Ozs7O09BQy9DLENBQUMsQ0FBQztBQUNILFdBQUssQ0FBQzs7Ozs7K0NBQ0UsTUFBTSxDQUFDLGFBQWEsRUFBRTs7Ozs7OztPQUM3QixDQUFDLENBQUM7O0FBRUgsY0FBUSxDQUFDLHNCQUFzQixFQUFFLFlBQU07QUFDckMsY0FBTSxDQUFDOzs7OztpREFDQyxNQUFNLENBQUMsYUFBYSxDQUFDLE9BQU8sRUFBRSxrQkFBa0IsQ0FBQzs7Ozs7OztTQUN4RCxDQUFDLENBQUM7O21CQUVpQixDQUFDLEtBQUssRUFBRSxZQUFZLEVBQUUsYUFBYSxDQUFDO0FBQXhELGlEQUEwRDtBQUFyRCxjQUFJLE9BQU8sV0FBQSxDQUFBOzs7Ozs7a0JBQ0wsSUFBSTs7QUFDWCxzQkFBUSxDQUFDLElBQUksQ0FBQyxLQUFLLEVBQUUsWUFBTTtBQUN6QixrQkFBRSxDQUFDLDJCQUEyQixFQUFFOzs7Ozt5REFDeEIsZUFBZSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxDQUFDOzs7Ozs7O2lCQUN6QyxDQUFDLENBQUM7QUFDSCxrQkFBRSxDQUFDLHVCQUF1QixFQUFFOzs7Ozt5REFDcEIsZUFBZSxDQUFDLE1BQU0sRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQzs7Ozs7OztpQkFDL0MsQ0FBQyxDQUFDO2VBQ0osQ0FBQyxDQUFDOzs7QUFSTCwrQ0FBaUIsT0FBTyxpSEFBRTs7YUFTekI7Ozs7Ozs7Ozs7Ozs7OztTQUNGO09BQ0YsQ0FBQyxDQUFDO0tBQ0osQ0FBQyxDQUFDO0dBQ0osQ0FBQyxDQUFDO0NBQ0osQ0FBQyxDQUFDIiwiZmlsZSI6InRlc3RcXGZ1bmN0aW9uYWxcXGNvbW1hbmRzXFxrZXlib2FyZC1lMmUtc3BlY3MuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgY2hhaSBmcm9tICdjaGFpJztcclxuaW1wb3J0IGNoYWlBc1Byb21pc2VkIGZyb20gJ2NoYWktYXMtcHJvbWlzZWQnO1xyXG5pbXBvcnQgXyBmcm9tICdsb2Rhc2gnO1xyXG5pbXBvcnQgc2FtcGxlQXBwcyBmcm9tICdzYW1wbGUtYXBwcyc7XHJcbmltcG9ydCBBbmRyb2lkVWlhdXRvbWF0b3IyRHJpdmVyIGZyb20gJy4uLy4uLy4uJztcclxuXHJcbmNoYWkuc2hvdWxkKCk7XHJcbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcclxuXHJcbmNvbnN0IEVESVRURVhUX0NMQVNTID0gJ2FuZHJvaWQud2lkZ2V0LkVkaXRUZXh0JztcclxuXHJcbmNvbnN0IFBBQ0tBR0UgPSAnaW8uYXBwaXVtLmFuZHJvaWQuYXBpcyc7XHJcbmNvbnN0IFRFWFRGSUVMRF9BQ1RJVklUWSA9ICcudmlldy5UZXh0RmllbGRzJztcclxuXHJcbmxldCBkZWZhdWx0QXNjaWlDYXBzID0ge1xyXG4gIGFwcDogc2FtcGxlQXBwcygnQXBpRGVtb3MtZGVidWcnKSxcclxuICBkZXZpY2VOYW1lOiAnQW5kcm9pZCcsXHJcbiAgcGxhdGZvcm1OYW1lOiAnQW5kcm9pZCcsXHJcbiAgbmV3Q29tbWFuZFRpbWVvdXQ6IDkwLFxyXG4gIGFwcFBhY2thZ2U6IFBBQ0tBR0UsXHJcbiAgYXBwQWN0aXZpdHk6IFRFWFRGSUVMRF9BQ1RJVklUWVxyXG59O1xyXG5cclxubGV0IGRlZmF1bHRVbmljb2RlQ2FwcyA9IF8uZGVmYXVsdHMoe1xyXG4gIHVuaWNvZGVLZXlib2FyZDogdHJ1ZSxcclxuICByZXNldEtleWJvYXJkOiB0cnVlXHJcbn0sIGRlZmF1bHRBc2NpaUNhcHMpO1xyXG5cclxuZnVuY3Rpb24gZGVTYW1zdW5naWZ5ICh0ZXh0KSB7XHJcbiAgLy8gRm9yIHNhbXN1bmcgUzUgdGV4dCBpcyBhcHBlbmRlZCB3aXRoIFwiLiBFZGl0aW5nLlwiXHJcbiAgcmV0dXJuIHRleHQucmVwbGFjZShcIi4gRWRpdGluZy5cIiwgXCJcIik7XHJcbn1cclxuXHJcbmFzeW5jIGZ1bmN0aW9uIHJ1blRleHRFZGl0VGVzdCAoZHJpdmVyLCB0ZXN0VGV4dCwga2V5cyA9IGZhbHNlKSB7XHJcbiAgbGV0IGVsID0gXy5sYXN0KGF3YWl0IGRyaXZlci5maW5kRWxPckVscygnY2xhc3MgbmFtZScsIEVESVRURVhUX0NMQVNTLCB0cnVlKSk7XHJcbiAgZWwgPSBlbC5FTEVNRU5UO1xyXG4gIGF3YWl0IGRyaXZlci5jbGVhcihlbCk7XHJcblxyXG4gIGlmIChrZXlzKSB7XHJcbiAgICBhd2FpdCBkcml2ZXIua2V5cyhbdGVzdFRleHRdKTtcclxuICB9IGVsc2Uge1xyXG4gICAgYXdhaXQgZHJpdmVyLnNldFZhbHVlKHRlc3RUZXh0LCBlbCk7XHJcbiAgfVxyXG5cclxuICBsZXQgdGV4dCA9IGF3YWl0IGRyaXZlci5nZXRUZXh0KGVsKTtcclxuICBkZVNhbXN1bmdpZnkodGV4dCkuc2hvdWxkLmJlLmVxdWFsKHRlc3RUZXh0KTtcclxuXHJcbiAgcmV0dXJuIGVsO1xyXG59XHJcblxyXG5sZXQgdGVzdHMgPSBbXHJcbiAgeyBsYWJlbDogJ2VkaXRpbmcgYSB0ZXh0IGZpZWxkJywgdGV4dDogJ0xpZmUsIHRoZSBVbml2ZXJzZSBhbmQgRXZlcnl0aGluZy4nIH0sXHJcbiAgeyBsYWJlbDogJ3NlbmRpbmcgXFwnJi1cXCcnLCB0ZXh0OiAnJi0nIH0sXHJcbiAgeyBsYWJlbDogJ3NlbmRpbmcgXFwnJlxcJyBhbmQgXFwnLVxcJyBpbiBvdGhlciB0ZXh0JywgdGV4dDogJ0luIHRoZSBtaWQtMTk5MHMgaGUgYXRlIGZpc2ggJiBjaGlwcyBhcyBtYXlvci1lbGVjdC4nIH0sXHJcbiAgeyBsYWJlbDogJ3NlbmRpbmcgXFwnLVxcJyBpbiB0ZXh0JywgdGV4dDogJ1N1cGVyLXRlc3QuJyB9LFxyXG4gIHsgbGFiZWw6ICdzZW5kaW5nIG51bWJlcnMnLCB0ZXh0OiAnMDEyMzQ1Njc4OSd9LFxyXG5dO1xyXG5cclxubGV0IHVuaWNvZGVUZXN0cyA9IFtcclxuICB7IGxhYmVsOiAnc2hvdWxkIGJlIGFibGUgdG8gc2VuZCBcXCctXFwnIGluIHVuaWNvZGUgdGV4dCcsIHRleHQ6ICfgpKrgpLDgpYDgpJXgpY3gpLfgpL4t4KSq4KSw4KWA4KSV4KWN4KS34KSjJyB9LFxyXG4gIHsgbGFiZWw6ICdzaG91bGQgYmUgYWJsZSB0byBzZW5kIFxcJyZcXCcgaW4gdGV4dCcsIHRleHQ6ICdGaXNoICYgY2hpcHMnIH0sXHJcbiAgeyBsYWJlbDogJ3Nob3VsZCBiZSBhYmxlIHRvIHNlbmQgXFwnJlxcJyBpbiB1bmljb2RlIHRleHQnLCB0ZXh0OiAnTcSrbmEgJiBjaGlwcycgfSxcclxuICB7IGxhYmVsOiAnc2hvdWxkIGJlIGFibGUgdG8gc2VuZCByb21hbiBjaGFyYWN0ZXJzIHdpdGggZGlhY3JpdGljcycsIHRleHQ6ICfDgcOpIMWSIMO5IOG4jScgfSxcclxuICB7IGxhYmVsOiAnc2hvdWxkIGJlIGFibGUgdG8gc2VuZCBhIFxcJ3VcXCcgd2l0aCBhbiB1bWxhdXQnLCB0ZXh0OiAnw7wnIH0sXHJcbl07XHJcblxyXG5sZXQgbGFuZ3VhZ2VUZXN0cyA9IFtcclxuICB7IGxhYmVsOiAnc2hvdWxkIGJlIGFibGUgdG8gc2VuZCBUYW1pbCcsIHRleHQ6ICfgrprgr4fgrr7grqTgrqngr4gnIH0sXHJcbiAgeyBsYWJlbDogJ3Nob3VsZCBiZSBhYmxlIHRvIHNlbmQgR3VqYXJhdGknLCB0ZXh0OiAn4Kqq4Kqw4KuA4KqV4KuN4Kq34KqjJyB9LFxyXG4gIHsgbGFiZWw6ICdzaG91bGQgYmUgYWJsZSB0byBzZW5kIENoaW5lc2UnLCB0ZXh0OiAn5rWL6K+VJyB9LFxyXG4gIHsgbGFiZWw6ICdzaG91bGQgYmUgYWJsZSB0byBzZW5kIFJ1c3NpYW4nLCB0ZXh0OiAn0YLQtdGB0YLQuNGA0L7QstCw0L3QuNC1JyB9LFxyXG4gIHsgbGFiZWw6ICdzaG91bGQgYmUgYWJsZSB0byBzZW5kIEFyYWJpYycsIHRleHQ6ICfYqtis2LHZitioJyB9LFxyXG4gIHsgbGFiZWw6ICdzaG91bGQgYmUgYWJsZSB0byBzZW5kIEhlYnJldycsIHRleHQ6ICfXkdeT15nXp9eV16onIH0sXHJcbl07XHJcblxyXG5kZXNjcmliZSgna2V5Ym9hcmQnLCAoKSA9PiB7XHJcbiAgZGVzY3JpYmUoJ2FzY2lpJywgKCkgPT4ge1xyXG4gICAgbGV0IGRyaXZlcjtcclxuICAgIGJlZm9yZShhc3luYyAoKSA9PiB7XHJcbiAgICAgIGRyaXZlciA9IG5ldyBBbmRyb2lkVWlhdXRvbWF0b3IyRHJpdmVyKCk7XHJcbiAgICAgIGF3YWl0IGRyaXZlci5jcmVhdGVTZXNzaW9uKGRlZmF1bHRBc2NpaUNhcHMpO1xyXG5cclxuICAgICAgLy8gc29tZXRpbWVzIHRoZSBkZWZhdWx0IGltZSBpcyBub3Qgd2hhdCB3ZSBhcmUgdXNpbmdcclxuICAgICAgbGV0IGVuZ2luZXMgPSBhd2FpdCBkcml2ZXIuYXZhaWxhYmxlSU1FRW5naW5lcygpO1xyXG4gICAgICBsZXQgc2VsZWN0ZWRFbmdpbmUgPSBfLmZpcnN0KGVuZ2luZXMpO1xyXG4gICAgICBmb3IgKGxldCBlbmdpbmUgb2YgZW5naW5lcykge1xyXG4gICAgICAgIC8vIGl0IHNlZW1zIHRoYXQgdGhlIGxhdGluIGltZSBoYXMgYGFuZHJvaWQuaW5wdXRtZXRob2RgIGluIGl0cyBwYWNrYWdlIG5hbWVcclxuICAgICAgICBpZiAoZW5naW5lLmluZGV4T2YoJ2FuZHJvaWQuaW5wdXRtZXRob2QnKSAhPT0gLTEpIHtcclxuICAgICAgICAgIHNlbGVjdGVkRW5naW5lID0gZW5naW5lO1xyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgICBhd2FpdCBkcml2ZXIuYWN0aXZhdGVJTUVFbmdpbmUoc2VsZWN0ZWRFbmdpbmUpO1xyXG4gICAgfSk7XHJcbiAgICBhZnRlcihhc3luYyAoKSA9PiB7XHJcbiAgICAgIGF3YWl0IGRyaXZlci5kZWxldGVTZXNzaW9uKCk7XHJcbiAgICB9KTtcclxuXHJcblxyXG4gICAgZGVzY3JpYmUoJ2VkaXRpbmcgYSB0ZXh0IGZpZWxkJywgKCkgPT4ge1xyXG4gICAgICBiZWZvcmUoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGF3YWl0IGRyaXZlci5zdGFydEFjdGl2aXR5KFBBQ0tBR0UsIFRFWFRGSUVMRF9BQ1RJVklUWSk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZm9yIChsZXQgdGVzdCBvZiB0ZXN0cykge1xyXG4gICAgICAgIGRlc2NyaWJlKHRlc3QubGFiZWwsICgpID0+IHtcclxuICAgICAgICAgIGl0KCdzaG91bGQgd29yayB3aXRoIHNldFZhbHVlJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCBydW5UZXh0RWRpdFRlc3QoZHJpdmVyLCB0ZXN0LnRleHQpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBrZXlzJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgICAgICBhd2FpdCBydW5UZXh0RWRpdFRlc3QoZHJpdmVyLCB0ZXN0LnRleHQsIHRydWUpO1xyXG4gICAgICAgICAgfSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgIH1cclxuXHJcbiAgICAgIGl0KCdzaG91bGQgYmUgYWJsZSB0byBjbGVhciBhIHBhc3N3b3JkIGZpZWxkJywgYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIC8vIHRoZXJlIGlzIGN1cnJlbnRseSBubyB3YXkgdG8gYXNzZXJ0IGFueXRoaW5nIGFib3V0IHRoZSBjb250ZW50c1xyXG4gICAgICAgIC8vIG9mIGEgcGFzc3dvcmQgZmllbGQsIHNpbmNlIHRoZXJlIGlzIG5vIHdheSB0byBhY2Nlc3MgdGhlIGNvbnRlbnRzXHJcbiAgICAgICAgLy8gYnV0IHRoaXMgc2hvdWxkLCBhdCB0aGUgdmVyeSBsZWFzdCwgbm90IGZhaWxcclxuICAgICAgICBsZXQgZWxzID0gYXdhaXQgZHJpdmVyLmZpbmRFbE9yRWxzKCdjbGFzcyBuYW1lJywgRURJVFRFWFRfQ0xBU1MsIHRydWUpO1xyXG4gICAgICAgIGxldCBlbCA9IGVsc1sxXS5FTEVNRU5UO1xyXG5cclxuICAgICAgICBhd2FpdCBkcml2ZXIuc2V0VmFsdWUoJ3N1cGVyLWR1cGVyIHBhc3N3b3JkJywgZWwpO1xyXG4gICAgICAgIGF3YWl0IGRyaXZlci5jbGVhcihlbCk7XHJcbiAgICAgIH0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgZGVzY3JpYmUoJ3VuaWNvZGUnLCAoKSA9PiB7XHJcbiAgICAgIGxldCBkcml2ZXI7XHJcbiAgICAgIGJlZm9yZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgZHJpdmVyID0gbmV3IEFuZHJvaWRVaWF1dG9tYXRvcjJEcml2ZXIoKTtcclxuICAgICAgICBhd2FpdCBkcml2ZXIuY3JlYXRlU2Vzc2lvbihkZWZhdWx0VW5pY29kZUNhcHMpO1xyXG4gICAgICB9KTtcclxuICAgICAgYWZ0ZXIoYXN5bmMgKCkgPT4ge1xyXG4gICAgICAgIGF3YWl0IGRyaXZlci5kZWxldGVTZXNzaW9uKCk7XHJcbiAgICAgIH0pO1xyXG5cclxuICAgICAgZGVzY3JpYmUoJ2VkaXRpbmcgYSB0ZXh0IGZpZWxkJywgKCkgPT4ge1xyXG4gICAgICAgIGJlZm9yZShhc3luYyAoKSA9PiB7XHJcbiAgICAgICAgICBhd2FpdCBkcml2ZXIuc3RhcnRBY3Rpdml0eShQQUNLQUdFLCBURVhURklFTERfQUNUSVZJVFkpO1xyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBmb3IgKGxldCB0ZXN0U2V0IG9mIFt0ZXN0cywgdW5pY29kZVRlc3RzLCBsYW5ndWFnZVRlc3RzXSkge1xyXG4gICAgICAgICAgZm9yIChsZXQgdGVzdCBvZiB0ZXN0U2V0KSB7XHJcbiAgICAgICAgICAgIGRlc2NyaWJlKHRlc3QubGFiZWwsICgpID0+IHtcclxuICAgICAgICAgICAgICBpdCgnc2hvdWxkIHdvcmsgd2l0aCBzZXRWYWx1ZScsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHJ1blRleHRFZGl0VGVzdChkcml2ZXIsIHRlc3QudGV4dCk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgICAgaXQoJ3Nob3VsZCB3b3JrIHdpdGgga2V5cycsIGFzeW5jICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGF3YWl0IHJ1blRleHRFZGl0VGVzdChkcml2ZXIsIHRlc3QudGV4dCwgdHJ1ZSk7XHJcbiAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgfSk7XHJcbiAgICB9KTtcclxuICB9KTtcclxufSk7XHJcbiJdfQ==